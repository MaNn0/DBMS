#!/bin/bash

if [ -z "$1" ]; then
    echo "No database name provided."
    exit 1
fi

dbName="$1"
cd $dbName
echo "You are now connected to the database: $dbName"

exit=true
while $exit; do
    COLUMNS=1
    echo
    PS3="Choose an option in $dbName: "
    select option in "list tables" "create table" "insert into table" "update table" "select from table" "delete record" "drop table" "exit database"; do
        case $option in
        "list tables")
            if [[ -z "$(ls)" ]]; then
                echo "There are no tables in this database."
            else
                echo "Tables in $dbName:"
                ls
            fi
            ;;
        "create table")
            read -p "Enter table name to create: " tableName
            if [[ "$tableName" =~ \  ]]; then
                echo "Table name cannot contain spaces"
            else
                ../../cTable "$tableName"
            fi
            ;;
        "insert into table")
            read -p "Enter table name to insert into: " tableName
            if [[ -e "$tableName" ]]; then
                ../../insertTable "$tableName"
            else
                echo "Table '$tableName' does not exist."
            fi
            ;;
        "update table")
            read -p "Enter table name to update: " tableName
            if [[ -z "$tableName" || ! -e "$tableName" ]]; then
                echo "Table '$tableName' does not exist."
            else
                ../../uTable "$tableName" 
            fi
            ;;  
        "select from table")
            read -p "Enter table name to select from: " tableName
            if [[ -e "$tableName" ]]; then
                echo "under development select from table"
            else
                echo "Table '$tableName' does not exist."
            fi
            ;;
        "delete record")
            read -p "Enter table name to update: " tableName
            if [[ -z "$tableName" || ! -e "$tableName" ]]; then
                echo "Table '$tableName' does not exist."
            else
                ../../uTable "$tableName" 
            fi
            ;;
        "drop table")
            read -p "Enter table name to remove: " tableName
            if [[ -e "$tableName" ]]; then
                rm -f "$tableName"*
                echo "Table '$tableName' removed successfully."
            else
                echo "Table '$tableName' does not exist."
            fi
            ;;
        "exit database")
            echo "Exiting database '$dbName' and returning to the main menu."
            exit=false
            break
            ;;
        *)
            echo "UNKNOWN OPTION"
            ;;
        esac
    done
done